!function(t){var e={};function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(i,o,function(e){return t[e]}.bind(null,o));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){var i,o,n,s=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(o,n){function s(t){try{a(i.next(t))}catch(t){n(t)}}function u(t){try{a(i.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))};!function(s){if("object"==typeof t.exports){var u=s(r(1),e);void 0!==u&&(t.exports=u)}else o=[r,e],void 0===(n="function"==typeof(i=s)?i.apply(e,o):i)||(t.exports=n)}((function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r="2.3.7",i=108e5;var o;!function(t){t[t.NONE=0]="NONE",t[t.HARD=1]="HARD",t[t.SOFT=2]="SOFT"}(o||(o={}));class n{constructor(t){this.storageKey="__subscription",this.options=t,this.updateSubscription=this.updateSubscription.bind(this),this.subscribe=this.subscribe.bind(this),this.isSupported()&&this.setup()}static validateOptions(t){if(!t.subscriptionHost)throw new Error("Subscription host not provided");if(!t.publicKey)throw new Error("Public key not provided");if(!t.platformId)throw new Error("Platform Id not provided")}isSupported(){return!!("serviceWorker"in navigator&&"PushManager"in window)}getRegistrations(){return s(this,void 0,void 0,(function*(){return yield navigator.serviceWorker.getRegistration()}))}registerServiceWorker(){return s(this,void 0,void 0,(function*(){if(!this.options.serviceworker)throw new Error("Service worker url not provided.");return yield navigator.serviceWorker.register(this.options.serviceworker,{scope:"/"})}))}setup(){return s(this,void 0,void 0,(function*(){this.registration=(yield this.getRegistrations())||(yield this.registerServiceWorker());const t=yield this.getSubscription();if(t){const e=this.isUpdateNeeded(t);e===o.HARD?t.unsubscribe().then(this.subscribe):e===o.SOFT&&this.updateSubscription(t)}else this.subscribe()}))}isUpdateNeeded(t){try{const e=localStorage.getItem(this.storageKey);if(!e)return o.HARD;const n=JSON.parse(e);return void 0===n.ts||void 0===n.push||void 0===n.v?o.HARD:n.ts+i<Date.now()?o.SOFT:n.v!==r?o.HARD:JSON.stringify({storefront:+this.options.storefrontId,platform:+this.options.platformId,subscription:t,user:this.options.user})===JSON.stringify(n.push)?o.NONE:o.SOFT}catch(t){return o.HARD}}getSubscription(){return s(this,void 0,void 0,(function*(){return yield this.registration.pushManager.getSubscription()}))}subscribe(){this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.options.publicKey)}).then(this.updateSubscription).catch(t=>{console.warn("Failed to subscribe for push notifications:"+t.name)})}updateSubscription(t){const e=JSON.stringify(t);try{localStorage.setItem(this.storageKey,JSON.stringify({push:{storefront:+this.options.storefrontId,platform:+this.options.platformId,subscription:t,user:this.options.user},v:r,ts:Date.now()}))}catch(t){console.warn("Failed to persist subscription on local storage")}const i=new XMLHttpRequest;i.open("POST",this.options.subscriptionHost+"/subscription",!0),this.options.user&&i.setRequestHeader("auth",this.options.user.token),i.setRequestHeader("platform",this.options.platformId.toString()),i.setRequestHeader("storefront",this.options.storefrontId.toString()),i.setRequestHeader("Content-type","application/json"),i.send(e)}urlBase64ToUint8Array(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(e);return Uint8Array.from([...r].map(t=>t.charCodeAt(0)))}}e.WebPushManager=n,e.pushClientClosure=()=>{let t;return e=>(n.validateOptions(e),t||(t=new n(e)))},window.WebPushManager=e.pushClientClosure()}))},function(t,e){function r(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id=1}]);
//# sourceMappingURL=client.7f1de7a56ca9e5783eaa.bundle.js.map